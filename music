#!/bin/sh
# dwmblocks cmus music block (clickable + truncated title + paused shows same title)

# Handle clicks
case $BLOCK_BUTTON in
    2) cmus-remote -u ;;  # Middle click → toggle play/pause
esac

# Fetch info from cmus
info=$(cmus-remote -Q 2>/dev/null)

# Exit if cmus isn't running
[ -z "$info" ] && exit

# Get playback status
status=$(echo "$info" | awk '/^status/ {print $2}')
title=$(echo "$info" | awk -F 'title ' '/^tag title/ {print $2}')

# If no title, exit silently
[ -z "$title" ] && exit

# Truncate long titles
maxlen=25
if [ ${#title} -gt $maxlen ]; then
    title="${title:0:$maxlen}…"
fi

# Show icon depending on status
if [ "$status" = "playing" ]; then
    echo " $title"
elif [ "$status" = "paused" ]; then
    echo " $title"
fi

